---
layout: post
title: 'Oracle Convergence: never-ending story of 0-day'
date: '2015-11-13T13:16:00.000+01:00'
author: marcing
tags:
- cross site scripting
- vulnerability
- xss
- zero day
- 0day
- oracle
- 0-day
- webmail
- convergence
- CVE-2015-4793
- pentests
modified_time: '2015-11-13T13:16:51.047+01:00'
thumbnail: http://1.bp.blogspot.com/-lipmRbwi5BY/VkXRPH8GoHI/AAAAAAAAAJw/XJGJOtAVA68/s72-c/s1.jpg
blogger_id: tag:blogger.com,1999:blog-252370192815002266.post-2286860087356920621
blogger_orig_url: https://blog.pentests.pl/2015/11/oracle-convergence-never-ending-story.html
excerpt: Finally, I&nbsp;can write about one of my findings, vendor fixed it. Some of you might be familiar with Oracle's product called Convergence.
---

...DARY!!! Finally, I&nbsp;can write about one of my findings, vendor fixed it. Some of you might be familiar with Oracle's product called Convergence. It is a&nbsp;web application, part of Oracle Communications Messaging Server. According to <a href="https://en.wikipedia.org/wiki/Oracle_Communications_Messaging_Server" target="top">wiki</a>:

```
"Oracle's Messaging Server could potentially be the most widely deployed commercial
email server on the planet, with claims of 150 million mailboxes deployed worldwide
(mostly by ISPs, telcos, universities, government, and cable TV broadband providers)."
```

Quick search on Google for "Convergence webmail" shows there are few instances running around ;) Now imagine there was a&nbsp;Cross Site Scripting vulnerability in it... no big deal right? Little background about Convergence... almost everything is handled by JavaScript, so with XSS you can do whatever you want, send emails, add contacts, read emails etc. More interesting, right? What if this vulnerability was inside part which displays email message, so to get owned you only had to open malicious email? Now we talking :)

Ahh, one more thing, I&nbsp;have found 2&nbsp;of these :)

Now, before you continue... I&nbsp;want to play a&nbsp;game with you... What do you think... How long it took for Oracle to fix these issues? Days? Months? So one of them around 5&nbsp;months, and the second one around… hmmm... 15-16 months. Yes, they knew about it for at least 15 months... how long was it there... who knows.

Let the fun part begin.

### Issue#1: Images bad! We protect!

This one has been found 2nd, but fixed as 1st (only 5&nbsp;months). Email clients protect users by blocking images inside message. Sooo our message has a&nbsp;img inside:

```html
<img src="blah"/>
```

>"Hey Bob! How we gonna block these images in our webmail?"  
>"That's super easy man, just replace all ‘src=\*’with empty string"

Yes, you see it right. You are protected in 100% from nasty pictures and in addition you receive XSS! If you decide to enable images XSS goes away.

I won't provide ready to use PoC, reason should be clear.

Interesting thing I've learnt about Oracle... if you are their customer (long story short, I've used my previous company’s account to contact them) and you report vuln in their app they will do 2&nbsp;things:
- patch it quietly,
- don't give you any credits at all.

Thank you Oracle, great work! In the end, they closed my ticket and fixed reported issue, yay!

### Issue#2: Don't rush mate... be coool!

Now the 15 months one...btw to make things funnier, there was a&nbsp;workaround to stop this vulnerability, but I'm not aware of any comms from Oracle to their customers to apply it (#SuperHardCommandToChangeOneOption).

Every webmail client has to have proper XSS filters in place. JavaScript can add new "depth" to messages, but probably no one wants that kind of "depth". There are different ways to sanitize message. I&nbsp;have no idea what had been used in Convergence, but based on the 1st issue I'd say "replace" FTW!

For some reasons they really didn't like this string:
```
target="_top" href='data:javascript;base64,'
```
which properly placed (somewhere in the middle) would let an attacker inject any html tag into the message viewer :) To hide any sign of malicious message I&nbsp;had to inject an opening tag for comment too (browser will close this one for you).

So here's my evil message waiting inside inbox:

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2015-11-13/s1.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="322" src="/images/2015-11-13/s1.jpg" width="640" />
  </a>
</div>

Let's view it:

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2015-11-13/s2.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="322" src="/images/2015-11-13/s2.jpg" width="640" />
  </a>
</div>

Here's how this looks in code:

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2015-11-13/source.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="314" src="/images/2015-11-13/source.jpg" width="640" />
  </a>
</div>

```html
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 4.01 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html class="MailMessagePane"><head><link rel="stylesheet" type="text/css" href="../layout/css/mail/MessagePane.css?"></link></head><body><div class="MailMessagePane-messageBody"><div><div class="mimetype-text-html">Hello
 as<script>
    alert(document.cookie);
</script><!--
></div></div><div class="MailMessagePane-inlineContainer"></div></div></body></html>--></div>
```

Again, I&nbsp;won't post how the payload should look, because I'm quite sure a&nbsp;lot of companies are still running vulnerable versions (one can still find instances vulnerable to stuff described <a href="http://database.developer-works.com/article/16000065/Sun+Convergence+-+allow+access+with+spaces+as+password" target="top">here</a>, lol).

I have just found CVE number of my issue (hopefully this one is mine, lol): CVE-2015-4793. Found it while googling for link to security patch release xD

This ends my story with Oracle... I&nbsp;have received a&nbsp;simple: "Issues reported by you have been fixed [....] Thank you" email. Also seen my name and surname in credits box in release notes. Yay!! Hopefully, I&nbsp;will never have to report anything in Oracle's product again...
