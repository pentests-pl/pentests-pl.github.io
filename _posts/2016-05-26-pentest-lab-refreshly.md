---
layout: post
title: PENTEST LAB - /*re*/Freshly
date: '2016-05-26T15:07:00.001+02:00'
author: marcing
tags:
- vulnhub
- freshly
- pentest lab
modified_time: '2016-05-26T15:08:49.138+02:00'
thumbnail: https://1.bp.blogspot.com/-s1IkOCcQyUI/V0bsA3WM_PI/AAAAAAAAALU/rupPd6pkBmQEsRlFOAS8v1NRkP74WgifQCLcB/s72-c/netdiscover.PNG
blogger_id: tag:blogger.com,1999:blog-252370192815002266.post-1659533637845468105
blogger_orig_url: https://blog.pentests.pl/2016/05/pentest-lab-refreshly.html
excerpt: This one is a webapp challenge that wants you to steal a secret from a file and from my understanding can be finished without getting root on the box, but I'll include steps I've followed to totally pwn the box :)
---

It's good to be back... I remember I've encountered Freshly challenge some time ago, but somehow the walkthrough didn't get written xD This one is a webapp challenge that wants you to steal a secret from a file and from my understanding can be finished without getting root on the box, but I'll include steps I've followed to totally pwn the box :) You get the image from <a href="https://www.vulnhub.com/entry/tophatsec-freshly,118/" target="top">here</a>.

### No spoiler alerts this time :D

Let's start with looking up our target's IP:

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/netdiscover.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="424" src="/images/2016-05-26/netdiscover.PNG" width="640" />
  </a>
</div>

Followed by some **nmap** magic:

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/nmap.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="410" src="/images/2016-05-26/nmap.PNG" width="640" />
  </a>
</div>

Once everything is done it is clearly visible this box has some web stuff going on. Let's hit it with **dirbuster** and while it's working check content manually:

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/http.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="222" src="/images/2016-05-26/http.PNG" width="400" />
  </a>
</div>

Hmmmm...Jedi...Jedi everywhere. Let's check HTTPS:
<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/https.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="220" src="/images/2016-05-26/https.png" width="640" />
  </a>
</div>

That's something : )

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/wp_admin_login.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="534" src="/images/2016-05-26/wp_admin_login.PNG" width="640" />
  </a>
</div>

This one is clearly a Wordpress so a small **wpscan** won't hurt. While it did find some interesting vulnerabilities in plugins I've decided not to follow them yet, all because of this one line:

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/jedi_mind_tricks.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="65" src="/images/2016-05-26/jedi_mind_tricks.PNG" width="400" />
  </a>
</div>

Missed you say...ok, you can trick me, but try that with **dirbuster** and:

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/dirbuster.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="457" src="/images/2016-05-26/dirbuster.PNG" width="640" />
  </a>
</div>

you fail! Hmmm phpmyadmin and some **login.php** page. Let's visit it:
<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/login_php.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="90" src="/images/2016-05-26/login_php.PNG" width="320" />
  </a>
</div>

Yeah, can confirm...that is a login page, let's try the top username (`asd' or 1=1; --\`) followed by top password (`' or '1'='1`):

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/sqli_browser.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="93" src="/images/2016-05-26/sqli_browser.PNG" width="320" />
  </a>
</div>

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/sqli_browser_result.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="128" src="/images/2016-05-26/sqli_browser_result.PNG" width="320" />
  </a>
</div>

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/sqli.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="304" src="/images/2016-05-26/sqli.PNG" width="640" />
  </a>
</div>

Dunno about you but this smells like a SQLi for me, and yes, **sqlmap** picked that one without a problem. Small info here...I remember when I was pwning this box for the first time sqlmap did not want to work for unknown reasons and I had to use regexp to help it (start of line '1' and end of line was the one I used back then). After playing around with that SQLi I've found table containing creds for an admin user for Wordpress instance, and....they worked!

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/admin_logged_in.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="226" src="/images/2016-05-26/admin_logged_in.PNG" width="640" />
  </a>
</div>

Having admin access to the Wordpress I started looking around this thing. While it might surprise few, when I did this challenge for the first time, it was the first time I saw admin panel of Wordpress. It took me some time to figure out where I can go from that point. Seeing template editor with php files made me smile. After dropping simple php web shell my work here was done.

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/new_404.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="318" src="/images/2016-05-26/new_404.PNG" width="640" />
  </a>
</div>

While sending cmds through browser might seems cool I've quickly send one dropping me shell to my netcat listener.

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/web_shell.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="400" src="/images/2016-05-26/web_shell.PNG" width="321" />
  </a>
</div>

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/nc_browser.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="320" src="/images/2016-05-26/nc_browser.PNG" width="640" />
  </a>
</div>

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/nc.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="284" src="/images/2016-05-26/nc.PNG" width="640" />
  </a>
</div>

One of the first things I do after getting shell like that is spawning bash with a little help of Python:

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/fixing_bash.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" src="/images/2016-05-26/fixing_bash.PNG" />
  </a>
</div>

Let's start looking around, I wanted to check **/etc/passwd** and here's what I got:

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/passwd.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="480" src="/images/2016-05-26/passwd.PNG" width="640" />
  </a>
</div>

Looks like challenge is complete...but why stop now, right? After clicking around I've noticed that **/etc/shadow** has really interesting permissions set : )

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/shadow.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="68" src="/images/2016-05-26/shadow.PNG" width="640" />
  </a>
</div>

I've grabbed both files (**passwd** and **shadow**) to try cracking the passwords. Believe me or not, but for unknown reasons my **oclHashcat** failed to crack password for **root**, despite having dictionary containing a valid password. I know that because after hashcat I tried using **john** and it did crack all passwords, the root's one turned out to be the same as the one for admin user in Wordpress : ) So here it is:

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/cracked_passes.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="118" src="/images/2016-05-26/cracked_passes.PNG" width="640" />
  </a>
</div>

But how did you get root shell, you might ask : ) Here's the magic:

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/shel_inside_shell.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" src="/images/2016-05-26/shel_inside_shell.PNG" />
  </a>
</div>

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2016-05-26/box_owned.PNG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" height="184" src="/images/2016-05-26/box_owned.PNG" width="640" />
  </a>
</div>

>\# poweroff

I'm out! Hope you liked it : ) Cause I certainly did!  
